<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beziehungs-Screener | CryptoSpaces</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700;800&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --space-black: #000510;
            --accent-blue: #0ea5e9;
            --accent-cyan: #22d3ee;
            --accent-purple: #a855f7;
            --accent-pink: #ec4899;
            --accent-indigo: #6366f1;
            --accent-green: #22c55e;
            --accent-red: #ef4444;
            --accent-yellow: #fbbf24;
            --text-light: #f1f5f9;
            --gradient-connection: linear-gradient(135deg, #a855f7, #6366f1, #22d3ee);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--space-black);
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Language Toggle */
        [data-lang-de], [data-lang-en] { display: none; }
        body.lang-de [data-lang-de] { display: inline; }
        body.lang-en [data-lang-en] { display: inline; }

        .lang-switch {
            display: flex;
            gap: 5px;
            background: rgba(15,23,42,0.8);
            padding: 4px;
            border-radius: 8px;
            border: 1px solid rgba(168,85,247,0.3);
        }
        .lang-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.65rem;
            font-weight: 600;
            transition: all 0.2s;
            background: transparent;
            color: rgba(241,245,249,0.5);
        }
        .lang-btn.active {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-indigo));
            color: white;
        }

        /* Background */
        .connection-bg {
            position: fixed;
            inset: 0;
            z-index: 0;
            overflow: hidden;
        }
        .connection-bg::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(168,85,247,0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(99,102,241,0.12) 0%, transparent 50%);
        }
        .network-canvas {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        /* Header */
        .unified-header {
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 1000;
            background: linear-gradient(180deg, rgba(0, 5, 16, 0.95) 0%, rgba(0, 5, 16, 0) 100%);
            padding: 15px 30px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(168, 85, 247, 0.3);
        }
        .unified-left { display: flex; align-items: center; gap: 20px; }
        .unified-logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
        }
        .unified-nav { display: flex; gap: 12px; }
        .unified-nav-link {
            color: var(--accent-cyan);
            text-decoration: none;
            font-size: 0.65rem;
            font-family: 'Orbitron', sans-serif;
            padding: 7px 12px;
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 6px;
            transition: all 0.2s;
            background: rgba(168, 85, 247, 0.05);
        }
        .unified-nav-link:hover {
            background: rgba(168, 85, 247, 0.15);
            border-color: var(--accent-purple);
        }

        /* Main Content */
        .main-content {
            position: relative;
            z-index: 1;
            padding-top: 100px;
        }

        /* Hero */
        .hero-section {
            text-align: center;
            padding: 40px 30px 60px;
        }
        .hero-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            animation: networkPulse 2s ease-in-out infinite;
        }
        @keyframes networkPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .hero-title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.8rem, 4vw, 3rem);
            font-weight: 800;
            margin-bottom: 10px;
            background: var(--gradient-connection);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .hero-subtitle {
            font-size: 1.1rem;
            color: var(--accent-cyan);
            margin-bottom: 20px;
        }
        .hero-text {
            max-width: 800px;
            margin: 0 auto;
            font-size: 1rem;
            color: rgba(241,245,249,0.8);
            line-height: 1.7;
        }

        /* Interactive Network Section */
        .interactive-network {
            padding: 40px 30px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .network-card {
            background: linear-gradient(180deg, rgba(15,23,42,0.9) 0%, rgba(30,41,59,0.7) 100%);
            border: 1px solid rgba(168,85,247,0.3);
            border-radius: 24px;
            padding: 30px;
            position: relative;
        }
        .network-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: var(--gradient-connection);
            border-radius: 24px 24px 0 0;
        }
        .network-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .network-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            color: var(--accent-purple);
        }
        .network-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .control-btn {
            padding: 8px 16px;
            background: rgba(168,85,247,0.15);
            border: 1px solid rgba(168,85,247,0.3);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .control-btn:hover, .control-btn.active {
            background: rgba(168,85,247,0.3);
            border-color: var(--accent-purple);
        }
        .network-stage {
            position: relative;
            height: 500px;
            background: radial-gradient(ellipse at center, rgba(15,23,42,0.5) 0%, transparent 70%);
            border-radius: 16px;
            overflow: hidden;
        }
        #connectionCanvas {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }

        /* Dynamic Coin Tiles */
        .coin-tile {
            position: absolute;
            border-radius: 16px;
            background: rgba(15,23,42,0.9);
            border: 2px solid rgba(168,85,247,0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 20px rgba(168,85,247,0.2);
            z-index: 5;
        }
        .coin-tile:hover {
            transform: scale(1.15);
            z-index: 20;
            box-shadow: 0 0 40px rgba(168,85,247,0.5);
        }
        .coin-tile.active {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 50px rgba(34,211,238,0.6);
            z-index: 25;
        }
        .coin-tile .emoji {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        .coin-tile .symbol {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-light);
        }
        .coin-tile .change {
            font-size: 0.65rem;
            font-weight: 600;
            margin-top: 3px;
        }
        .coin-tile .change.positive { color: var(--accent-green); }
        .coin-tile .change.negative { color: var(--accent-red); }
        
        /* Tile States */
        .coin-tile.euphoria {
            border-color: var(--accent-green);
            background: rgba(34,197,94,0.15);
            box-shadow: 0 0 25px rgba(34,197,94,0.4);
        }
        .coin-tile.fear {
            border-color: var(--accent-red);
            background: rgba(239,68,68,0.15);
            box-shadow: 0 0 25px rgba(239,68,68,0.4);
        }
        .coin-tile.neutral {
            border-color: var(--accent-yellow);
            background: rgba(251,191,36,0.1);
        }
        .coin-tile.inactive {
            opacity: 0.4;
            transform: scale(0.9);
        }

        /* Connection Lines */
        .connection-line {
            position: absolute;
            pointer-events: none;
            transform-origin: left center;
            height: 3px;
            border-radius: 2px;
            z-index: 2;
        }
        .connection-line.positive {
            background: linear-gradient(90deg, rgba(34,197,94,0.8), rgba(34,197,94,0.3));
            box-shadow: 0 0 10px rgba(34,197,94,0.5);
        }
        .connection-line.negative {
            background: linear-gradient(90deg, rgba(239,68,68,0.8), rgba(239,68,68,0.3));
            box-shadow: 0 0 10px rgba(239,68,68,0.5);
        }
        .connection-line.neutral {
            background: linear-gradient(90deg, rgba(251,191,36,0.8), rgba(251,191,36,0.3));
            box-shadow: 0 0 10px rgba(251,191,36,0.5);
        }
        .connection-line.pulse {
            animation: linePulse 1s ease-in-out infinite;
        }
        @keyframes linePulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Detail Modal */
        .detail-modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 2000;
            background: rgba(0,0,0,0.85);
            justify-content: center;
            align-items: center;
        }
        .detail-modal.open { display: flex; }
        .modal-content {
            width: 450px;
            max-width: 90vw;
            max-height: 85vh;
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            border: 1px solid rgba(168,85,247,0.4);
            border-radius: 20px;
            overflow: hidden;
        }
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid rgba(168,85,247,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-coin {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .modal-coin .emoji { font-size: 2.5rem; }
        .modal-coin-info h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            color: var(--accent-purple);
        }
        .modal-coin-info span {
            font-size: 0.85rem;
            color: rgba(241,245,249,0.6);
        }
        .modal-close {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 10px;
            background: rgba(239,68,68,0.2);
            color: var(--accent-red);
            font-size: 1.3rem;
            cursor: pointer;
        }
        .modal-body {
            padding: 25px;
            overflow-y: auto;
            max-height: 60vh;
        }
        .modal-section {
            margin-bottom: 25px;
        }
        .modal-section h4 {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            color: var(--accent-cyan);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .stat-item {
            background: rgba(168,85,247,0.1);
            border-radius: 10px;
            padding: 12px;
        }
        .stat-label {
            font-size: 0.7rem;
            color: rgba(241,245,249,0.5);
            margin-bottom: 4px;
        }
        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            font-weight: 600;
        }
        .stat-value.positive { color: var(--accent-green); }
        .stat-value.negative { color: var(--accent-red); }
        .correlation-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .correlation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: rgba(15,23,42,0.6);
            border-radius: 8px;
            border-left: 3px solid;
        }
        .correlation-item.high { border-color: var(--accent-green); }
        .correlation-item.medium { border-color: var(--accent-yellow); }
        .correlation-item.low { border-color: var(--accent-indigo); }
        .correlation-item.negative { border-color: var(--accent-red); }
        .corr-coin {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        .corr-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            color: rgba(241,245,249,0.7);
        }
        .legend-color {
            width: 20px;
            height: 4px;
            border-radius: 2px;
        }
        .legend-color.positive { background: var(--accent-green); }
        .legend-color.negative { background: var(--accent-red); }
        .legend-color.neutral { background: var(--accent-yellow); }

        /* Footer */
        .footer {
            background: rgba(15,23,42,0.9);
            border-top: 1px solid rgba(168,85,247,0.2);
            padding: 30px;
            text-align: center;
            margin-top: 60px;
        }
        .footer-disclaimer {
            max-width: 700px;
            margin: 0 auto;
            padding: 15px;
            background: rgba(168,85,247,0.1);
            border: 1px solid rgba(168,85,247,0.3);
            border-radius: 10px;
            font-size: 0.75rem;
            color: rgba(241,245,249,0.6);
        }
        .footer-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .footer-link {
            color: rgba(241,245,249,0.5);
            text-decoration: none;
            font-size: 0.8rem;
        }
        .footer-link:hover { color: var(--accent-purple); }

        @media (max-width: 768px) {
            .unified-nav { display: none; }
            .network-stage { height: 400px; }
            .coin-tile { transform: scale(0.85); }
            .modal-content { margin: 20px; }
        }
    </style>
</head>
<body class="lang-de">
    <div class="connection-bg">
        <canvas class="network-canvas" id="networkCanvas"></canvas>
    </div>

    <header class="unified-header">
        <div class="unified-left">
            <a href="index.html" class="unified-logo">CRYPTOSPACES</a>
            <nav class="unified-nav">
                <a href="index.html" class="unified-nav-link">üè† Home</a>
                <a href="top100.html" class="unified-nav-link">üèÜ Top 100</a>
                <a href="narrative-screener.html" class="unified-nav-link">üìñ Narrative</a>
                <a href="emotion-screener.html" class="unified-nav-link">üíì Emotion</a>
                <a href="relationship-screener.html" class="unified-nav-link" style="background: rgba(168,85,247,0.2);">üîó Beziehung</a>
            </nav>
        </div>
        <div class="lang-switch">
            <button class="lang-btn active" onclick="setLang('de')">DE</button>
            <button class="lang-btn" onclick="setLang('en')">EN</button>
        </div>
    </header>

    <main class="main-content">
        <section class="hero-section">
            <div class="hero-icon">üîó</div>
            <h1 class="hero-title">
                <span data-lang-de>Beziehungs-Screener</span>
                <span data-lang-en>Relationship Screener</span>
            </h1>
            <p class="hero-subtitle">
                <span data-lang-de>Interaktive Coin-Verbindungen in Echtzeit</span>
                <span data-lang-en>Interactive Coin Connections in Real-Time</span>
            </p>
            <p class="hero-text">
                <span data-lang-de>Klicke auf einen Coin, um seine Verbindungen zu sehen. Hover √ºber Kacheln zeigt dynamische Korrelationslinien. Die Gr√∂√üe und Farbe der Kacheln zeigt Marktaktivit√§t und Stimmung.</span>
                <span data-lang-en>Click on a coin to see its connections. Hover over tiles to show dynamic correlation lines. Tile size and color indicate market activity and sentiment.</span>
            </p>
        </section>

        <section class="interactive-network">
            <div class="network-card">
                <div class="network-header">
                    <h2 class="network-title">
                        <span data-lang-de>üåê Live Coin-Netzwerk</span>
                        <span data-lang-en>üåê Live Coin Network</span>
                    </h2>
                    <div class="network-controls">
                        <button class="control-btn active" onclick="setFilter('all')">
                            <span data-lang-de>Alle</span><span data-lang-en>All</span>
                        </button>
                        <button class="control-btn" onclick="setFilter('positive')">
                            <span data-lang-de>üü¢ Positiv</span><span data-lang-en>üü¢ Positive</span>
                        </button>
                        <button class="control-btn" onclick="setFilter('negative')">
                            <span data-lang-de>üî¥ Negativ</span><span data-lang-en>üî¥ Negative</span>
                        </button>
                        <button class="control-btn" onclick="shufflePositions()">
                            <span data-lang-de>üîÄ Mischen</span><span data-lang-en>üîÄ Shuffle</span>
                        </button>
                    </div>
                </div>
                <div class="network-stage" id="networkStage">
                    <canvas id="connectionCanvas"></canvas>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color positive"></div>
                        <span data-lang-de>Positive Korrelation</span><span data-lang-en>Positive Correlation</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color neutral"></div>
                        <span data-lang-de>Neutrale Korrelation</span><span data-lang-en>Neutral Correlation</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color negative"></div>
                        <span data-lang-de>Negative Korrelation</span><span data-lang-en>Negative Correlation</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-disclaimer">
            <strong>‚ö†Ô∏è</strong> 
            <span data-lang-de>Der Beziehungs-Screener liefert keine finanziellen Empfehlungen. Alle Informationen dienen der Marktanalyse.</span>
            <span data-lang-en>The Relationship Screener does not provide financial advice. All information is for market analysis only.</span>
        </div>
        <nav class="footer-nav">
            <a href="index.html" class="footer-link">Home</a>
            <a href="top100.html" class="footer-link">Top 100</a>
            <a href="narrative-screener.html" class="footer-link">Narrative</a>
            <a href="emotion-screener.html" class="footer-link">Emotion</a>
        </nav>
    </footer>

    <!-- Detail Modal -->
    <div class="detail-modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-coin">
                    <span class="emoji" id="modalEmoji">‚Çø</span>
                    <div class="modal-coin-info">
                        <h3 id="modalName">Bitcoin</h3>
                        <span id="modalSymbol">BTC</span>
                    </div>
                </div>
                <button class="modal-close" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h4>üìä <span data-lang-de>Marktdaten</span><span data-lang-en>Market Data</span></h4>
                    <div class="stat-grid">
                        <div class="stat-item">
                            <div class="stat-label"><span data-lang-de>Preis</span><span data-lang-en>Price</span></div>
                            <div class="stat-value" id="modalPrice">$0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">24h</div>
                            <div class="stat-value" id="modalChange">0%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label"><span data-lang-de>Volumen</span><span data-lang-en>Volume</span></div>
                            <div class="stat-value" id="modalVolume">$0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label"><span data-lang-de>Marktstimmung</span><span data-lang-en>Sentiment</span></div>
                            <div class="stat-value" id="modalSentiment">Neutral</div>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <h4>üîó <span data-lang-de>Top Korrelationen</span><span data-lang-en>Top Correlations</span></h4>
                    <div class="correlation-list" id="correlationList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Language
        function setLang(lang) {
            document.body.classList.remove('lang-de', 'lang-en');
            document.body.classList.add('lang-' + lang);
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            localStorage.setItem('cryptospaces_lang', lang);
        }
        const savedLang = localStorage.getItem('cryptospaces_lang');
        if (savedLang) setLang(savedLang);

        // Coin Data
        const coins = [
            { id: 'btc', name: 'Bitcoin', symbol: 'BTC', emoji: '‚Çø', price: 98500, change: 2.4, volume: '45B', sentiment: 'euphoria' },
            { id: 'eth', name: 'Ethereum', symbol: 'ETH', emoji: 'Œû', price: 3850, change: 3.1, volume: '22B', sentiment: 'euphoria' },
            { id: 'sol', name: 'Solana', symbol: 'SOL', emoji: '‚óé', price: 215, change: -1.2, volume: '5B', sentiment: 'neutral' },
            { id: 'xrp', name: 'XRP', symbol: 'XRP', emoji: '‚úï', price: 2.35, change: -2.8, volume: '8B', sentiment: 'fear' },
            { id: 'ada', name: 'Cardano', symbol: 'ADA', emoji: '‚óè', price: 1.05, change: 1.5, volume: '2B', sentiment: 'neutral' },
            { id: 'avax', name: 'Avalanche', symbol: 'AVAX', emoji: '‚óÜ', price: 42, change: 4.2, volume: '1.5B', sentiment: 'euphoria' },
            { id: 'link', name: 'Chainlink', symbol: 'LINK', emoji: '‚¨°', price: 24, change: 0.8, volume: '800M', sentiment: 'neutral' },
            { id: 'dot', name: 'Polkadot', symbol: 'DOT', emoji: '‚óâ', price: 8.5, change: -0.5, volume: '600M', sentiment: 'neutral' },
            { id: 'matic', name: 'Polygon', symbol: 'MATIC', emoji: '‚ñ≤', price: 0.58, change: -3.1, volume: '400M', sentiment: 'fear' },
            { id: 'atom', name: 'Cosmos', symbol: 'ATOM', emoji: '‚öõ', price: 9.2, change: 1.9, volume: '350M', sentiment: 'neutral' }
        ];

        // Correlations (simplified)
        const correlations = {
            'btc': { 'eth': 0.85, 'sol': 0.72, 'xrp': 0.45, 'ada': 0.62, 'avax': 0.78, 'link': 0.68, 'dot': 0.55, 'matic': 0.48, 'atom': 0.52 },
            'eth': { 'btc': 0.85, 'sol': 0.82, 'xrp': 0.38, 'ada': 0.71, 'avax': 0.88, 'link': 0.75, 'dot': 0.65, 'matic': 0.72, 'atom': 0.58 },
            'sol': { 'btc': 0.72, 'eth': 0.82, 'xrp': 0.28, 'ada': 0.55, 'avax': 0.78, 'link': 0.62, 'dot': 0.48, 'matic': 0.65, 'atom': 0.42 },
            'xrp': { 'btc': 0.45, 'eth': 0.38, 'sol': 0.28, 'ada': 0.52, 'avax': 0.32, 'link': 0.35, 'dot': 0.48, 'matic': 0.25, 'atom': 0.38 },
            'ada': { 'btc': 0.62, 'eth': 0.71, 'sol': 0.55, 'xrp': 0.52, 'avax': 0.65, 'link': 0.58, 'dot': 0.72, 'matic': 0.55, 'atom': 0.68 },
            'avax': { 'btc': 0.78, 'eth': 0.88, 'sol': 0.78, 'xrp': 0.32, 'ada': 0.65, 'link': 0.72, 'dot': 0.58, 'matic': 0.68, 'atom': 0.52 },
            'link': { 'btc': 0.68, 'eth': 0.75, 'sol': 0.62, 'xrp': 0.35, 'ada': 0.58, 'avax': 0.72, 'dot': 0.55, 'matic': 0.62, 'atom': 0.48 },
            'dot': { 'btc': 0.55, 'eth': 0.65, 'sol': 0.48, 'xrp': 0.48, 'ada': 0.72, 'avax': 0.58, 'link': 0.55, 'matic': 0.52, 'atom': 0.75 },
            'matic': { 'btc': 0.48, 'eth': 0.72, 'sol': 0.65, 'xrp': 0.25, 'ada': 0.55, 'avax': 0.68, 'link': 0.62, 'dot': 0.52, 'atom': 0.45 },
            'atom': { 'btc': 0.52, 'eth': 0.58, 'sol': 0.42, 'xrp': 0.38, 'ada': 0.68, 'avax': 0.52, 'link': 0.48, 'dot': 0.75, 'matic': 0.45 }
        };

        // State
        let activeCoin = null;
        let currentFilter = 'all';
        let tilePositions = {};

        // Initialize
        const stage = document.getElementById('networkStage');
        const canvas = document.getElementById('connectionCanvas');
        const ctx = canvas.getContext('2d');

        function initCanvas() {
            canvas.width = stage.offsetWidth;
            canvas.height = stage.offsetHeight;
        }

        function generatePositions() {
            const w = stage.offsetWidth;
            const h = stage.offsetHeight;
            const positions = [
                { x: 0.5, y: 0.5 },   // Center (BTC)
                { x: 0.25, y: 0.3 },  // ETH
                { x: 0.75, y: 0.25 }, // SOL
                { x: 0.15, y: 0.6 },  // XRP
                { x: 0.85, y: 0.55 }, // ADA
                { x: 0.35, y: 0.75 }, // AVAX
                { x: 0.65, y: 0.8 },  // LINK
                { x: 0.2, y: 0.85 },  // DOT
                { x: 0.8, y: 0.85 },  // MATIC
                { x: 0.5, y: 0.15 }   // ATOM
            ];
            coins.forEach((coin, i) => {
                tilePositions[coin.id] = {
                    x: positions[i].x * w,
                    y: positions[i].y * h
                };
            });
        }

        function getTileSize(coin) {
            const base = 70;
            const volumeMultiplier = Math.abs(coin.change) / 5 + 0.8;
            return Math.min(Math.max(base * volumeMultiplier, 60), 100);
        }

        function createTiles() {
            stage.querySelectorAll('.coin-tile').forEach(t => t.remove());
            
            coins.forEach(coin => {
                const tile = document.createElement('div');
                const size = getTileSize(coin);
                const pos = tilePositions[coin.id];
                
                tile.className = `coin-tile ${coin.sentiment}`;
                tile.id = `tile-${coin.id}`;
                tile.style.width = `${size}px`;
                tile.style.height = `${size}px`;
                tile.style.left = `${pos.x - size/2}px`;
                tile.style.top = `${pos.y - size/2}px`;
                
                tile.innerHTML = `
                    <span class="emoji">${coin.emoji}</span>
                    <span class="symbol">${coin.symbol}</span>
                    <span class="change ${coin.change >= 0 ? 'positive' : 'negative'}">${coin.change >= 0 ? '+' : ''}${coin.change}%</span>
                `;
                
                tile.addEventListener('mouseenter', () => showConnections(coin.id));
                tile.addEventListener('mouseleave', () => { if (!activeCoin) clearConnections(); });
                tile.addEventListener('click', () => openModal(coin));
                
                stage.appendChild(tile);
            });
        }

        function showConnections(coinId) {
            clearConnections();
            const coin = coins.find(c => c.id === coinId);
            const corrs = correlations[coinId];
            const fromPos = tilePositions[coinId];
            
            document.querySelectorAll('.coin-tile').forEach(t => {
                if (t.id !== `tile-${coinId}`) t.classList.add('inactive');
            });
            document.getElementById(`tile-${coinId}`).classList.add('active');
            
            Object.entries(corrs).forEach(([targetId, value]) => {
                if (currentFilter === 'positive' && value < 0.6) return;
                if (currentFilter === 'negative' && value > 0.4) return;
                
                const toPos = tilePositions[targetId];
                const dx = toPos.x - fromPos.x;
                const dy = toPos.y - fromPos.y;
                const length = Math.sqrt(dx*dx + dy*dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                const line = document.createElement('div');
                line.className = `connection-line pulse ${value > 0.6 ? 'positive' : value < 0.4 ? 'negative' : 'neutral'}`;
                line.style.left = `${fromPos.x}px`;
                line.style.top = `${fromPos.y}px`;
                line.style.width = `${length}px`;
                line.style.transform = `rotate(${angle}deg)`;
                line.style.opacity = Math.min(value + 0.3, 1);
                
                stage.appendChild(line);
                
                // Show target tile
                document.getElementById(`tile-${targetId}`).classList.remove('inactive');
            });
        }

        function clearConnections() {
            stage.querySelectorAll('.connection-line').forEach(l => l.remove());
            document.querySelectorAll('.coin-tile').forEach(t => {
                t.classList.remove('active', 'inactive');
            });
        }

        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.control-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            if (activeCoin) showConnections(activeCoin);
        }

        function shufflePositions() {
            const w = stage.offsetWidth;
            const h = stage.offsetHeight;
            const padding = 60;
            
            coins.forEach(coin => {
                tilePositions[coin.id] = {
                    x: padding + Math.random() * (w - padding * 2),
                    y: padding + Math.random() * (h - padding * 2)
                };
            });
            
            // Animate tiles to new positions
            coins.forEach(coin => {
                const tile = document.getElementById(`tile-${coin.id}`);
                const pos = tilePositions[coin.id];
                const size = getTileSize(coin);
                tile.style.left = `${pos.x - size/2}px`;
                tile.style.top = `${pos.y - size/2}px`;
            });
            
            clearConnections();
        }

        function openModal(coin) {
            activeCoin = coin.id;
            showConnections(coin.id);
            
            document.getElementById('modalEmoji').textContent = coin.emoji;
            document.getElementById('modalName').textContent = coin.name;
            document.getElementById('modalSymbol').textContent = coin.symbol;
            document.getElementById('modalPrice').textContent = '$' + coin.price.toLocaleString();
            document.getElementById('modalChange').textContent = (coin.change >= 0 ? '+' : '') + coin.change + '%';
            document.getElementById('modalChange').className = `stat-value ${coin.change >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('modalVolume').textContent = '$' + coin.volume;
            
            const sentiments = { euphoria: 'ü§ë Euphorie', neutral: 'üòê Neutral', fear: 'üò® Angst' };
            document.getElementById('modalSentiment').textContent = sentiments[coin.sentiment];
            
            // Correlations
            const corrList = document.getElementById('correlationList');
            corrList.innerHTML = '';
            const sorted = Object.entries(correlations[coin.id]).sort((a,b) => b[1] - a[1]).slice(0, 5);
            sorted.forEach(([id, val]) => {
                const c = coins.find(x => x.id === id);
                const cls = val > 0.7 ? 'high' : val > 0.5 ? 'medium' : val > 0.35 ? 'low' : 'negative';
                corrList.innerHTML += `
                    <div class="correlation-item ${cls}">
                        <span class="corr-coin">${c.emoji} ${c.symbol}</span>
                        <span class="corr-value">${(val * 100).toFixed(0)}%</span>
                    </div>
                `;
            });
            
            document.getElementById('detailModal').classList.add('open');
        }

        function closeModal() {
            document.getElementById('detailModal').classList.remove('open');
            activeCoin = null;
            clearConnections();
        }

        // Background animation
        const bgCanvas = document.getElementById('networkCanvas');
        const bgCtx = bgCanvas.getContext('2d');
        let bgNodes = [];

        function initBg() {
            bgCanvas.width = window.innerWidth;
            bgCanvas.height = window.innerHeight;
            bgNodes = [];
            for (let i = 0; i < 40; i++) {
                bgNodes.push({
                    x: Math.random() * bgCanvas.width,
                    y: Math.random() * bgCanvas.height,
                    vx: (Math.random() - 0.5) * 0.3,
                    vy: (Math.random() - 0.5) * 0.3,
                    r: Math.random() * 2 + 1
                });
            }
        }

        function drawBg() {
            bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
            bgCtx.strokeStyle = 'rgba(168, 85, 247, 0.08)';
            for (let i = 0; i < bgNodes.length; i++) {
                for (let j = i + 1; j < bgNodes.length; j++) {
                    const dx = bgNodes[i].x - bgNodes[j].x;
                    const dy = bgNodes[i].y - bgNodes[j].y;
                    const d = Math.sqrt(dx*dx + dy*dy);
                    if (d < 120) {
                        bgCtx.globalAlpha = (120 - d) / 120 * 0.2;
                        bgCtx.beginPath();
                        bgCtx.moveTo(bgNodes[i].x, bgNodes[i].y);
                        bgCtx.lineTo(bgNodes[j].x, bgNodes[j].y);
                        bgCtx.stroke();
                    }
                }
            }
            bgCtx.globalAlpha = 1;
            bgNodes.forEach(n => {
                bgCtx.fillStyle = 'rgba(168, 85, 247, 0.4)';
                bgCtx.beginPath();
                bgCtx.arc(n.x, n.y, n.r, 0, Math.PI * 2);
                bgCtx.fill();
                n.x += n.vx;
                n.y += n.vy;
                if (n.x < 0 || n.x > bgCanvas.width) n.vx *= -1;
                if (n.y < 0 || n.y > bgCanvas.height) n.vy *= -1;
            });
            requestAnimationFrame(drawBg);
        }

        // Init
        window.addEventListener('load', () => {
            initCanvas();
            generatePositions();
            createTiles();
            initBg();
            drawBg();
        });
        window.addEventListener('resize', () => {
            initCanvas();
            generatePositions();
            createTiles();
            initBg();
        });
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
        document.getElementById('detailModal').addEventListener('click', e => { if (e.target.id === 'detailModal') closeModal(); });
    </script>
</body>
</html>
